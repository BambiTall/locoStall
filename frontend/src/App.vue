<script setup>
import Navigation from "../src/components/Navigation.vue";
import { useRouter, useRoute } from "vue-router";
import { reactive, ref, computed, onBeforeMount, onMounted, watch } from 'vue';
import { useStore } from "vuex";


const store = useStore();
const router = useRouter();

// local storage
const localstorage_lang = ref(localStorage.getItem('lang'));
const localstorage_login = ref(Boolean(localStorage.getItem('login')));

// getters
const currLang = ref(store.getters.currLang);

// const checkLocalStorage = async () => {
//   try {
//     let useLang = ''

//     if (localstorage_login.value) {
//       // logged in
//       if (localstorage_lang.value) {
//         // lang set

//         useLang = localstorage_lang.value
//       } else {
//         console.log("logged in but lang hasn't been set");
//       }
//     } else {
//       // not logged in
//       // use default lang
//       useLang = currLang.value
//     }
//     store.dispatch('setCurrLang', useLang);
//   } catch (error) {
//     console.error(error);
//   }
// };

router.beforeEach((to, from, next) => {
  // console.log('to',to);
  // console.log('to.params.lang',to.params.lang);
  
  if (to.fullPath === '/' || to.fullPath === '/undefined' ) {
    // visit with no lang
    next({ path: `/${currLang.value}` });
  } else {
    // visit with lang
    store.dispatch('setCurrLang', to.params.lang);
    next();
  }
});

// const initApp = async () => {
//   try {
//     await checkLocalStorage();
//   } catch (error) {
//     console.error('@initApp', error);
//   }
// };

onBeforeMount(() => {
});

// onMounted(async () => {
//   try {
//     await Promise.all([initApp()]);
//   } catch (error) {
//     console.error('onMounted', error);
//   }
// });
</script>

<template>
   <a-layout>
    <a-layout-header :style="{ position: 'fixed', zIndex: 1, width: '100%' }">      
      <Navigation />
    </a-layout-header>
    <a-layout-content :style="{ marginTop: '64px' }" class="_body">
      <router-view/>
    </a-layout-content>
    <a-layout-footer :style="{ textAlign: 'center' }">
      Â© locoStall 2023
    </a-layout-footer>
  </a-layout>
</template>

<style lang="scss">
@import "../src/assets/scss/style.scss";

._body{
  padding: 50px;
}
</style>
